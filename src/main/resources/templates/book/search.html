<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<title>本を探す | 読書記録管理システム</title>
	<link th:href="@{/css/bootstrap.min.css}" rel="stylesheet">
	<link th:href="@{/css/style.css}" rel="stylesheet">
	<style>
		.book-card {
			border: 1px solid #ddd;
			border-radius: 10px;
			padding: 15px;
			transition: box-shadow 0.2s;
		}

		.book-card:hover {
			box-shadow: 0 0 12px rgba(0, 0, 0, 0.15);
		}

		.book-thumb {
			width: 90px;
			height: 120px;
			background-color: #eaeaea;
			border-radius: 5px;
			object-fit: cover;
		}
	</style>
</head>

<body>

	<!-- ▼ Header（タイトル中央, ログアウト右端, 下段メニュー） ▼ -->
	<header class="bg-dark text-white py-3 mb-4">
		<div class="container">
			<div class="d-flex align-items-center position-relative">
				<h1 class="text-center flex-grow-1 m-0 fs-3">読書記録管理システム</h1>
				<div class="position-absolute end-0">
					<a th:href="@{/logout}" class="btn btn-outline-light btn-sm">ログアウト</a>
				</div>
			</div>

			<nav class="mt-3">
				<ul class="nav justify-content-center">
					<li class="nav-item"><a th:href="@{/home}" class="nav-link px-3 text-white">トップ</a></li>
					<li class="nav-item"><a th:href="@{/book/search}" class="nav-link px-3 text-white">本を探す</a></li>
					<li class="nav-item"><a href="/book/list" class="nav-link px-3 text-white">マイ本棚</a></li>
					<li class="nav-item"><a href="/book/recommend" class="nav-link px-3 text-white">あなたへのおすすめ</a></li>
					<li class="nav-item"><a href="/book/review/list" class="nav-link px-3 text-white">新着レビュー</a></li>
					<li class="nav-item"><a href="/book/ranking" class="nav-link px-3 text-white">ランキング</a></li>
				</ul>
			</nav>
		</div>
	</header>


	<!-- ▼ Main Content ▼ -->
	<div class="container">

		<h2 class="mb-4">本を探す</h2>

		<!-- ▼ 検索フォーム ▼ -->
		<form th:action="@{/book/search}" method="get" class="mb-4">
			<div class="row g-2">

				<!-- ジャンル選択 -->
				<div class="col-md-3">
					<select name="genreId" class="form-select">
						<option value="0" th:selected="${genreId == 0}">全て</option>
						<option th:each="g : ${genres}" th:value="${g.id}" th:text="${g.name}"
							th:selected="${g.id == genreId}">
						</option>
					</select>
				</div>

				<!-- キーワード -->
				<div class="col-md-7">
					<input type="text" name="keyword" class="form-control" placeholder="書名・著者名で検索"
						th:value="${keyword}">
				</div>

				<!-- 検索ボタン -->
				<div class="col-md-2 d-grid">
					<button class="btn btn-primary" name="doSearch" value="1">検索</button>
				</div>
				
			</div>
			
		</form>

		<!-- ▼ マニュアル入力 / レコメンド ▼ -->
		<div class="mb-4">
			<a href="/book/add" class="btn btn-outline-secondary me-2">自分で本を登録（手動入力）</a>
			<a href="/book/recommend" class="btn btn-outline-success">おすすめを調べる</a>
		</div>

		<hr>

		<!-- ▼ 検索結果（画像なし・シンプル縦型カード） ▼ -->
		<div class="mt-4">

			<!-- 件数表示 -->
			<p th:if="${totalCount > 0}" th:text="|${totalCount} 件見つかりました|"></p>
			<p th:if="${totalCount == 0}">該当する本が見つかりませんでした。</p>

			<!-- 本の一覧 -->
			<div th:if="${bookList != null}">
				<div th:each="book : ${bookList}" class="book-card mb-3">
					<h5 class="mb-1" th:text="${book.title}"></h5>
					<div class="text-muted small mb-1">著者：
						<span th:text="${book.author}"></span>
					</div>
					<div class="text-muted small mb-1">出版社：
						<span th:text="${book.publisher}"></span>
					</div>
					<div class="text-muted small mb-1">発行日：
						<span th:text="${book.publisherAt}"></span>
					</div>
					<div class="text-muted small mb-2">ジャンル：
						<span th:text="${book.bookGenre.name}"></span>
					</div>
					<a th:href="@{/book/add-booklist(bookId=${book.id})}" class="btn btn-outline-primary btn-sm">本棚に追加</a>
				</div>


				<!--<a th:href="@{'/book/addToShelf/' + ${book.id}}" class="btn btn-outline-primary btn-sm">本棚に追加</a>-->
			</div>

			<!--<div class="book-card mb-3">
				<h5 class="mb-1">ハリーポッターと賢者の石</h5>
				<div class="text-muted small mb-1">著者：J.K.ローリング</div>
				<div class="text-muted small mb-1">出版社：静山社</div>
				<div class="text-muted small mb-1">発行日：2001-12-01</div>
				<div class="text-muted small mb-2">ジャンル：小説</div>
				<a href="#" class="btn btn-outline-primary btn-sm">本棚に追加</a>
			</div>-->

		</div>


		<!-- ページネーション -->
		<ul class="pagination mt-4" th:if="${totalPages >= 2}">
			<li class="page-item" th:classappend="${page == 1} ? 'disabled'">
				<a class="page-link" th:href="@{/book/search(
					keyword=${keyword},
					genreId=${genreId},
					sort=${sort},
					page=${page - 1})}">
					&laquo;</a>
			</li>

			<li class="page-item" th:each="i : ${#numbers.sequence(1, totalPages)}"
				th:classappend="${i == page} ? 'active'">
				<a class="page-link" th:href="@{/book/search(
					keyword=${keyword},
					genreId=${genreId},
					sort=${sort},
					page=${i})}" th:text="${i}"></a>
			</li>

			<li class="page-item" th:classappend="${page == totalPages} ? 'disabled'">
				<a class="page-link" th:href="@{/book/search(
					keyword=${keyword},
					genreId=${genreId},
					sort=${sort},
					page=${page + 1})}">
					&raquo;</a>
			</li>
		</ul>
		<!-- ページネーション -->

		<!-- ▼ トップページへ戻る ▼ -->
		<div class="text-center mt-5">
			<a th:href="@{/home}" class="btn btn-secondary">トップページへ戻る</a>
		</div>

	</div>

	<!-- ▼ Footer ▼ -->
	<footer class="mt-5 py-3 bg-dark text-center text-white">
		© 読書記録管理システム
	</footer>

</body>

</html>